{"ast":null,"code":"import _objectSpread from\"/Users/nawaf/code/Create-a-D3-Dashboard-With-React-/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _defineProperty from\"/Users/nawaf/code/Create-a-D3-Dashboard-With-React-/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/Users/nawaf/code/Create-a-D3-Dashboard-With-React-/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import MapVisualizerLoader from'./loaders/MapVisualizer';import{Delta7Icon,PerLakhIcon}from'./snippets/Icons';import StatisticDropdown from'./StatisticDropdown';import Tooltip from'./Tooltip';import{MAP_META,MAP_TYPES,MAP_VIEWS,MAP_VIZS,MAP_STATISTICS,SPRING_CONFIG_NUMBERS,STATE_NAMES,STATISTIC_CONFIGS,UNKNOWN_DISTRICT_KEY}from'../constants';import{formatNumber,getStatistic,retry}from'../utils/commonFunctions';import{ArrowLeftIcon,DotFillIcon,PinIcon,OrganizationIcon}from'@primer/octicons-react';import classnames from'classnames';import equal from'fast-deep-equal';import produce from'immer';import{memo,useCallback,useEffect,useMemo,useRef,Suspense,lazy}from'react';import{useTranslation}from'react-i18next';import{useHistory}from'react-router-dom';import{animated,useSpring}from'react-spring';import{useSwipeable}from'react-swipeable';import{useSessionStorage,useWindowSize}from'react-use';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var MapVisualizer=/*#__PURE__*/lazy(function(){return retry(function(){return import('./MapVisualizer');});});function MapExplorer(_ref){var _statisticConfig$mapC,_statisticConfig$mapC2,_statisticConfig$mapC4,_this=this,_mapExplorerRef$curre;var _ref$stateCode=_ref.stateCode,mapCode=_ref$stateCode===void 0?'TT':_ref$stateCode,data=_ref.data,_ref$mapView=_ref.mapView,mapView=_ref$mapView===void 0?MAP_VIEWS.DISTRICTS:_ref$mapView,setMapView=_ref.setMapView,mapStatistic=_ref.mapStatistic,setMapStatistic=_ref.setMapStatistic,regionHighlighted=_ref.regionHighlighted,setRegionHighlighted=_ref.setRegionHighlighted,noRegionHighlightedDistrictData=_ref.noRegionHighlightedDistrictData,anchor=_ref.anchor,setAnchor=_ref.setAnchor,_ref$expandTable=_ref.expandTable,expandTable=_ref$expandTable===void 0?false:_ref$expandTable,lastDataDate=_ref.lastDataDate,_ref$hideDistrictData=_ref.hideDistrictData,hideDistrictData=_ref$hideDistrictData===void 0?false:_ref$hideDistrictData,_ref$hideDistrictTest=_ref.hideDistrictTestData,hideDistrictTestData=_ref$hideDistrictTest===void 0?true:_ref$hideDistrictTest,_ref$hideVaccinated=_ref.hideVaccinated,hideVaccinated=_ref$hideVaccinated===void 0?false:_ref$hideVaccinated,_ref$noDistrictData=_ref.noDistrictData,noDistrictData=_ref$noDistrictData===void 0?false:_ref$noDistrictData;var _useTranslation=useTranslation(),t=_useTranslation.t;var mapExplorerRef=useRef();var _useWindowSize=useWindowSize(),width=_useWindowSize.width;var _useSessionStorage=useSessionStorage('isPerLakhMap',false),_useSessionStorage2=_slicedToArray(_useSessionStorage,2),isPerLakh=_useSessionStorage2[0],setIsPerLakh=_useSessionStorage2[1];var _useSessionStorage3=useSessionStorage('delta7ModeMap',false),_useSessionStorage4=_slicedToArray(_useSessionStorage3,2),delta7Mode=_useSessionStorage4[0],setDelta7Mode=_useSessionStorage4[1];var mapMeta=MAP_META[mapCode];var mapData=mapMeta.mapType===MAP_TYPES.COUNTRY?data:_defineProperty({},mapCode,data[mapCode]);var statisticConfig=STATISTIC_CONFIGS[mapStatistic];var isDistrictView=mapView===MAP_VIEWS.DISTRICTS&&(mapMeta.mapType===MAP_TYPES.STATE||!hideDistrictData&&!(hideDistrictTestData&&(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.category)==='tested'));var hoveredRegion=useMemo(function(){var _data$regionHighlight,_data$regionHighlight2;var hoveredData=(regionHighlighted.districtName?(_data$regionHighlight=data[regionHighlighted.stateCode])===null||_data$regionHighlight===void 0?void 0:(_data$regionHighlight2=_data$regionHighlight.districts)===null||_data$regionHighlight2===void 0?void 0:_data$regionHighlight2[regionHighlighted.districtName]:data[regionHighlighted.stateCode])||{};return produce(hoveredData,function(draft){draft.name=regionHighlighted.districtName||STATE_NAMES[regionHighlighted.stateCode];});},[data,regionHighlighted.stateCode,regionHighlighted.districtName]);var handlePerLakhClick=useCallback(function(){var statisticConfig=STATISTIC_CONFIGS[mapStatistic];if((statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.nonLinear)||mapStatistic==='population'){return;}setIsPerLakh(function(isPerLakh){return!isPerLakh;});},[mapStatistic,setIsPerLakh]);var handleDistrictClick=useCallback(function(){var newMapView=mapView===MAP_VIEWS.DISTRICTS?MAP_VIEWS.STATES:MAP_VIEWS.DISTRICTS;if(newMapView===MAP_VIEWS.STATES){setRegionHighlighted({stateCode:regionHighlighted.stateCode,districtName:null});}setMapView(newMapView);},[mapView,regionHighlighted.stateCode,setMapView,setRegionHighlighted]);var history=useHistory();var panelRef=useRef();useEffect(function(){if(history.location.hash==='#MapExplorer'){panelRef.current.scrollIntoView();}},[history]);var trail=useMemo(function(){var styles=[];[0,0,0,0,0,0,0].map(function(element,index){styles.push({animationDelay:\"\".concat(index*250,\"ms\")});return null;});return styles;},[]);var getMapStatistic=useCallback(function(data){var statisticConfig=STATISTIC_CONFIGS[mapStatistic];var type=(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.showDelta)&&delta7Mode||(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.onlyDelta7)?'delta7':'total';return getStatistic(data,type,mapStatistic,{expiredDate:lastDataDate,normalizedByPopulationPer:isPerLakh&&mapStatistic!='population'?'lakh':null,canBeNaN:true});},[mapStatistic,isPerLakh,lastDataDate,delta7Mode]);var currentVal=getMapStatistic(hoveredRegion);if(isNaN(currentVal)){currentVal='-';}var spring=useSpring({total:currentVal,config:_objectSpread({tension:250},SPRING_CONFIG_NUMBERS)});var mapStatistics=useMemo(function(){return MAP_STATISTICS.filter(function(statistic){var _STATISTIC_CONFIGS$st;return!(((_STATISTIC_CONFIGS$st=STATISTIC_CONFIGS[statistic])===null||_STATISTIC_CONFIGS$st===void 0?void 0:_STATISTIC_CONFIGS$st.category)==='vaccinated')||!hideVaccinated;});},[hideVaccinated]);var handleStatisticChange=useCallback(function(direction){var currentIndex=mapStatistics.indexOf(mapStatistic);var toIndex=(mapStatistics.length+currentIndex+direction)%mapStatistics.length;setMapStatistic(mapStatistics[toIndex]);},[mapStatistic,mapStatistics,setMapStatistic]);var swipeHandlers=useSwipeable({onSwipedLeft:handleStatisticChange.bind(this,1),onSwipedRight:handleStatisticChange.bind(this,-1)});var mapViz=(statisticConfig===null||statisticConfig===void 0?void 0:(_statisticConfig$mapC=statisticConfig.mapConfig)===null||_statisticConfig$mapC===void 0?void 0:_statisticConfig$mapC.spike)?MAP_VIZS.SPIKE:isPerLakh||(statisticConfig===null||statisticConfig===void 0?void 0:(_statisticConfig$mapC2=statisticConfig.mapConfig)===null||_statisticConfig$mapC2===void 0?void 0:_statisticConfig$mapC2.colorScale)||(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.nonLinear)?MAP_VIZS.CHOROPLETH:MAP_VIZS.BUBBLE;var handleDeltaClick=useCallback(function(){if(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.showDelta){setDelta7Mode(function(delta7Mode){return!delta7Mode;});}},[statisticConfig,setDelta7Mode]);var stickied=anchor==='mapexplorer'||expandTable&&width>=769;var transformStatistic=useCallback(function(val){var _statisticConfig$mapC3;return(statisticConfig===null||statisticConfig===void 0?void 0:(_statisticConfig$mapC3=statisticConfig.mapConfig)===null||_statisticConfig$mapC3===void 0?void 0:_statisticConfig$mapC3.transformFn)?statisticConfig.mapConfig.transformFn(val):val;},[statisticConfig]);var zoneColor=(statisticConfig===null||statisticConfig===void 0?void 0:(_statisticConfig$mapC4=statisticConfig.mapConfig)===null||_statisticConfig$mapC4===void 0?void 0:_statisticConfig$mapC4.colorScale)?statisticConfig.mapConfig.colorScale(transformStatistic(currentVal)):'';return/*#__PURE__*/_jsxs(\"div\",{className:classnames('MapExplorer',{stickied:stickied},{hidden:anchor&&anchor!=='mapexplorer'&&(!expandTable||width<769)}),children:[/*#__PURE__*/_jsx(\"div\",{className:classnames('anchor','fadeInUp',{stickied:stickied}),style:{display:width<769||width>=769&&expandTable?'none':''},onClick:setAnchor&&setAnchor.bind(this,anchor==='mapexplorer'?null:'mapexplorer'),children:/*#__PURE__*/_jsx(PinIcon,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"panel\",ref:panelRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-left fadeInUp\",style:trail[0],children:[/*#__PURE__*/_jsxs(\"h2\",{className:classnames(mapStatistic),style:{color:zoneColor||(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.color)},children:[t(hoveredRegion.name),hoveredRegion.name===UNKNOWN_DISTRICT_KEY&&\" [\".concat(t(STATE_NAMES[regionHighlighted.stateCode]),\"]\")]}),regionHighlighted.stateCode&&/*#__PURE__*/_jsxs(\"h1\",{className:classnames('district',mapStatistic),style:{color:zoneColor||(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.color)},children:[/*#__PURE__*/_jsx(animated.div,{children:spring.total.to(function(total){return!noRegionHighlightedDistrictData||!(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.hasPrimary)?formatNumber(total,statisticConfig.format,mapStatistic):'-';})}),/*#__PURE__*/_jsx(StatisticDropdown,{currentStatistic:mapStatistic,statistics:mapStatistics,mapType:mapMeta.mapType,isPerLakh:isPerLakh,delta7Mode:delta7Mode,mapStatistic:mapStatistic,setMapStatistic:setMapStatistic,hideDistrictTestData:hideDistrictTestData,hideVaccinated:hideVaccinated,zoneColor:zoneColor})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:classnames('panel-right',\"is-\".concat(mapStatistic)),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"switch-type\",children:[/*#__PURE__*/_jsx(Tooltip,{message:'Last 7 day values',hold:true,children:/*#__PURE__*/_jsx(\"div\",{className:classnames('toggle','fadeInUp',{'is-highlighted':delta7Mode&&(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.showDelta)||(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.onlyDelta7),disabled:!(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.showDelta)}),onClick:handleDeltaClick,style:trail[1],children:/*#__PURE__*/_jsx(Delta7Icon,{})})}),/*#__PURE__*/_jsx(Tooltip,{message:'Per lakh people',hold:true,children:/*#__PURE__*/_jsx(\"div\",{className:classnames('toggle','fadeInUp',{'is-highlighted':!(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.nonLinear)&&mapViz===MAP_VIZS.CHOROPLETH,disabled:(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.nonLinear)||mapStatistic==='population'}),onClick:handlePerLakhClick,style:trail[2],children:/*#__PURE__*/_jsx(PerLakhIcon,{})})}),mapMeta.mapType===MAP_TYPES.COUNTRY&&/*#__PURE__*/_jsx(Tooltip,{message:'Toggle between states/districts',hold:true,children:/*#__PURE__*/_jsx(\"div\",{className:classnames('toggle','boundary fadeInUp',{'is-highlighted':isDistrictView,disabled:hideDistrictData||(statisticConfig===null||statisticConfig===void 0?void 0:statisticConfig.category)==='tested'&&hideDistrictTestData}),onClick:handleDistrictClick,style:trail[3],children:/*#__PURE__*/_jsx(OrganizationIcon,{})})}),mapMeta.mapType===MAP_TYPES.STATE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"divider\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toggle back fadeInUp\",onClick:function onClick(){history.push('/#MapExplorer');},style:trail[4],children:/*#__PURE__*/_jsx(ArrowLeftIcon,{})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"switch-statistic fadeInUp\",style:trail[5],children:mapStatistics.map(function(statistic){return/*#__PURE__*/_jsx(\"div\",{className:classnames('toggle','statistic-option',\"is-\".concat(statistic),{'is-highlighted':mapStatistic===statistic}),onClick:setMapStatistic.bind(_this,statistic),children:/*#__PURE__*/_jsx(DotFillIcon,{})},statistic);})})]})]}),/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({ref:mapExplorerRef,className:\"fadeInUp\",style:trail[3]},swipeHandlers),{},{children:mapStatistic&&/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(MapVisualizerLoader,{className:\"map-loader\",width:(_mapExplorerRef$curre=mapExplorerRef.current)===null||_mapExplorerRef$curre===void 0?void 0:_mapExplorerRef$curre.clientWidth,statistic:mapStatistic}),children:/*#__PURE__*/_jsx(MapVisualizer,{data:mapData,statistic:mapStatistic,mapCode:mapCode,isDistrictView:isDistrictView,mapViz:mapViz,regionHighlighted:regionHighlighted,setRegionHighlighted:setRegionHighlighted,getMapStatistic:getMapStatistic,transformStatistic:transformStatistic,noDistrictData:noDistrictData})})}))]});}var isEqual=function isEqual(prevProps,currProps){var _prevProps$data,_prevProps$data$TT,_prevProps$data$TT$me,_currProps$data,_currProps$data$TT,_currProps$data$TT$me,_prevProps$data2,_prevProps$data2$TT,_currProps$data2,_currProps$data2$TT;if(!equal(prevProps.stateCode,currProps.stateCode)){return false;}else if(!equal(prevProps.regionHighlighted,currProps.regionHighlighted)){return false;}else if(!equal(prevProps.mapView,currProps.mapView)){return false;}else if(!equal(prevProps.mapStatistic,currProps.mapStatistic)){return false;}else if(!equal(prevProps.anchor,currProps.anchor)){return false;}else if(!equal(prevProps.expandTable,currProps.expandTable)){return false;}else if(!equal(prevProps.hideDistrictData,currProps.hideDistrictData)){return false;}else if(!equal(prevProps.hideDistrictTestData,currProps.hideDistrictTestData)){return false;}else if(!equal(prevProps.hideVaccinated,currProps.hideVaccinated)){return false;}else if(!equal(prevProps.lastDataDate,currProps.lastDataDate)){return false;}else if(!equal((_prevProps$data=prevProps.data)===null||_prevProps$data===void 0?void 0:(_prevProps$data$TT=_prevProps$data.TT)===null||_prevProps$data$TT===void 0?void 0:(_prevProps$data$TT$me=_prevProps$data$TT.meta)===null||_prevProps$data$TT$me===void 0?void 0:_prevProps$data$TT$me['last_updated'],(_currProps$data=currProps.data)===null||_currProps$data===void 0?void 0:(_currProps$data$TT=_currProps$data.TT)===null||_currProps$data$TT===void 0?void 0:(_currProps$data$TT$me=_currProps$data$TT.meta)===null||_currProps$data$TT$me===void 0?void 0:_currProps$data$TT$me['last_updated'])){return false;}else if(!equal((_prevProps$data2=prevProps.data)===null||_prevProps$data2===void 0?void 0:(_prevProps$data2$TT=_prevProps$data2.TT)===null||_prevProps$data2$TT===void 0?void 0:_prevProps$data2$TT.total,(_currProps$data2=currProps.data)===null||_currProps$data2===void 0?void 0:(_currProps$data2$TT=_currProps$data2.TT)===null||_currProps$data2$TT===void 0?void 0:_currProps$data2$TT.total)){return false;}else if(!equal(prevProps.noRegionHighlightedDistrictData,currProps.noRegionHighlightedDistrictData)){return false;}else if(!equal(prevProps.noDistrictData,currProps.noDistrictData)){return false;}return true;};export default/*#__PURE__*/memo(MapExplorer,isEqual);","map":{"version":3,"sources":["/Users/nawaf/code/Create-a-D3-Dashboard-With-React-/src/components/MapExplorer.js"],"names":["MapVisualizerLoader","Delta7Icon","PerLakhIcon","StatisticDropdown","Tooltip","MAP_META","MAP_TYPES","MAP_VIEWS","MAP_VIZS","MAP_STATISTICS","SPRING_CONFIG_NUMBERS","STATE_NAMES","STATISTIC_CONFIGS","UNKNOWN_DISTRICT_KEY","formatNumber","getStatistic","retry","ArrowLeftIcon","DotFillIcon","PinIcon","OrganizationIcon","classnames","equal","produce","memo","useCallback","useEffect","useMemo","useRef","Suspense","lazy","useTranslation","useHistory","animated","useSpring","useSwipeable","useSessionStorage","useWindowSize","MapVisualizer","MapExplorer","stateCode","mapCode","data","mapView","DISTRICTS","setMapView","mapStatistic","setMapStatistic","regionHighlighted","setRegionHighlighted","noRegionHighlightedDistrictData","anchor","setAnchor","expandTable","lastDataDate","hideDistrictData","hideDistrictTestData","hideVaccinated","noDistrictData","t","mapExplorerRef","width","isPerLakh","setIsPerLakh","delta7Mode","setDelta7Mode","mapMeta","mapData","mapType","COUNTRY","statisticConfig","isDistrictView","STATE","category","hoveredRegion","hoveredData","districtName","districts","draft","name","handlePerLakhClick","nonLinear","handleDistrictClick","newMapView","STATES","history","panelRef","location","hash","current","scrollIntoView","trail","styles","map","element","index","push","animationDelay","getMapStatistic","type","showDelta","onlyDelta7","expiredDate","normalizedByPopulationPer","canBeNaN","currentVal","isNaN","spring","total","config","tension","mapStatistics","filter","statistic","handleStatisticChange","direction","currentIndex","indexOf","toIndex","length","swipeHandlers","onSwipedLeft","bind","onSwipedRight","mapViz","mapConfig","spike","SPIKE","colorScale","CHOROPLETH","BUBBLE","handleDeltaClick","stickied","transformStatistic","val","transformFn","zoneColor","hidden","display","color","to","hasPrimary","format","disabled","clientWidth","isEqual","prevProps","currProps","TT","meta"],"mappings":"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","sourcesContent":["import MapVisualizerLoader from './loaders/MapVisualizer';\nimport {Delta7Icon, PerLakhIcon} from './snippets/Icons';\nimport StatisticDropdown from './StatisticDropdown';\nimport Tooltip from './Tooltip';\n\nimport {\n  MAP_META,\n  MAP_TYPES,\n  MAP_VIEWS,\n  MAP_VIZS,\n  MAP_STATISTICS,\n  SPRING_CONFIG_NUMBERS,\n  STATE_NAMES,\n  STATISTIC_CONFIGS,\n  UNKNOWN_DISTRICT_KEY,\n} from '../constants';\nimport {formatNumber, getStatistic, retry} from '../utils/commonFunctions';\n\nimport {\n  ArrowLeftIcon,\n  DotFillIcon,\n  PinIcon,\n  OrganizationIcon,\n} from '@primer/octicons-react';\nimport classnames from 'classnames';\nimport equal from 'fast-deep-equal';\nimport produce from 'immer';\nimport {\n  memo,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  Suspense,\n  lazy,\n} from 'react';\nimport {useTranslation} from 'react-i18next';\nimport {useHistory} from 'react-router-dom';\nimport {animated, useSpring} from 'react-spring';\nimport {useSwipeable} from 'react-swipeable';\nimport {useSessionStorage, useWindowSize} from 'react-use';\n\nconst MapVisualizer = lazy(() => retry(() => import('./MapVisualizer')));\n\nfunction MapExplorer({\n  stateCode: mapCode = 'TT',\n  data,\n  mapView = MAP_VIEWS.DISTRICTS,\n  setMapView,\n  mapStatistic,\n  setMapStatistic,\n  regionHighlighted,\n  setRegionHighlighted,\n  noRegionHighlightedDistrictData,\n  anchor,\n  setAnchor,\n  expandTable = false,\n  lastDataDate,\n  hideDistrictData = false,\n  hideDistrictTestData = true,\n  hideVaccinated = false,\n  noDistrictData = false,\n}) {\n  const {t} = useTranslation();\n  const mapExplorerRef = useRef();\n  const {width} = useWindowSize();\n\n  const [isPerLakh, setIsPerLakh] = useSessionStorage('isPerLakhMap', false);\n  const [delta7Mode, setDelta7Mode] = useSessionStorage('delta7ModeMap', false);\n\n  const mapMeta = MAP_META[mapCode];\n  const mapData =\n    mapMeta.mapType === MAP_TYPES.COUNTRY ? data : {[mapCode]: data[mapCode]};\n\n  const statisticConfig = STATISTIC_CONFIGS[mapStatistic];\n\n  const isDistrictView =\n    mapView === MAP_VIEWS.DISTRICTS &&\n    (mapMeta.mapType === MAP_TYPES.STATE ||\n      (!hideDistrictData &&\n        !(hideDistrictTestData && statisticConfig?.category === 'tested')));\n\n  const hoveredRegion = useMemo(() => {\n    const hoveredData =\n      (regionHighlighted.districtName\n        ? data[regionHighlighted.stateCode]?.districts?.[\n            regionHighlighted.districtName\n          ]\n        : data[regionHighlighted.stateCode]) || {};\n\n    return produce(hoveredData, (draft) => {\n      draft.name =\n        regionHighlighted.districtName ||\n        STATE_NAMES[regionHighlighted.stateCode];\n    });\n  }, [data, regionHighlighted.stateCode, regionHighlighted.districtName]);\n\n  const handlePerLakhClick = useCallback(() => {\n    const statisticConfig = STATISTIC_CONFIGS[mapStatistic];\n    if (statisticConfig?.nonLinear || mapStatistic === 'population') {\n      return;\n    }\n    setIsPerLakh((isPerLakh) => !isPerLakh);\n  }, [mapStatistic, setIsPerLakh]);\n\n  const handleDistrictClick = useCallback(() => {\n    const newMapView =\n      mapView === MAP_VIEWS.DISTRICTS ? MAP_VIEWS.STATES : MAP_VIEWS.DISTRICTS;\n    if (newMapView === MAP_VIEWS.STATES) {\n      setRegionHighlighted({\n        stateCode: regionHighlighted.stateCode,\n        districtName: null,\n      });\n    }\n    setMapView(newMapView);\n  }, [mapView, regionHighlighted.stateCode, setMapView, setRegionHighlighted]);\n\n  const history = useHistory();\n  const panelRef = useRef();\n\n  useEffect(() => {\n    if (history.location.hash === '#MapExplorer') {\n      panelRef.current.scrollIntoView();\n    }\n  }, [history]);\n\n  const trail = useMemo(() => {\n    const styles = [];\n\n    [0, 0, 0, 0, 0, 0, 0].map((element, index) => {\n      styles.push({\n        animationDelay: `${index * 250}ms`,\n      });\n      return null;\n    });\n\n    return styles;\n  }, []);\n\n  const getMapStatistic = useCallback(\n    (data) => {\n      const statisticConfig = STATISTIC_CONFIGS[mapStatistic];\n\n      const type =\n        (statisticConfig?.showDelta && delta7Mode) ||\n        statisticConfig?.onlyDelta7\n          ? 'delta7'\n          : 'total';\n\n      return getStatistic(data, type, mapStatistic, {\n        expiredDate: lastDataDate,\n        normalizedByPopulationPer:\n          isPerLakh && mapStatistic != 'population' ? 'lakh' : null,\n        canBeNaN: true,\n      });\n    },\n    [mapStatistic, isPerLakh, lastDataDate, delta7Mode]\n  );\n\n  let currentVal = getMapStatistic(hoveredRegion);\n  if (isNaN(currentVal)) {\n    currentVal = '-';\n  }\n\n  const spring = useSpring({\n    total: currentVal,\n    config: {tension: 250, ...SPRING_CONFIG_NUMBERS},\n  });\n\n  const mapStatistics = useMemo(\n    () =>\n      MAP_STATISTICS.filter(\n        (statistic) =>\n          !(STATISTIC_CONFIGS[statistic]?.category === 'vaccinated') ||\n          !hideVaccinated\n      ),\n    [hideVaccinated]\n  );\n\n  const handleStatisticChange = useCallback(\n    (direction) => {\n      const currentIndex = mapStatistics.indexOf(mapStatistic);\n      const toIndex =\n        (mapStatistics.length + currentIndex + direction) %\n        mapStatistics.length;\n      setMapStatistic(mapStatistics[toIndex]);\n    },\n    [mapStatistic, mapStatistics, setMapStatistic]\n  );\n\n  const swipeHandlers = useSwipeable({\n    onSwipedLeft: handleStatisticChange.bind(this, 1),\n    onSwipedRight: handleStatisticChange.bind(this, -1),\n  });\n\n  const mapViz = statisticConfig?.mapConfig?.spike\n    ? MAP_VIZS.SPIKE\n    : isPerLakh ||\n      statisticConfig?.mapConfig?.colorScale ||\n      statisticConfig?.nonLinear\n    ? MAP_VIZS.CHOROPLETH\n    : MAP_VIZS.BUBBLE;\n\n  const handleDeltaClick = useCallback(() => {\n    if (statisticConfig?.showDelta) {\n      setDelta7Mode((delta7Mode) => !delta7Mode);\n    }\n  }, [statisticConfig, setDelta7Mode]);\n\n  const stickied = anchor === 'mapexplorer' || (expandTable && width >= 769);\n\n  const transformStatistic = useCallback(\n    (val) =>\n      statisticConfig?.mapConfig?.transformFn\n        ? statisticConfig.mapConfig.transformFn(val)\n        : val,\n    [statisticConfig]\n  );\n\n  const zoneColor = statisticConfig?.mapConfig?.colorScale\n    ? statisticConfig.mapConfig.colorScale(transformStatistic(currentVal))\n    : '';\n\n  return (\n    <div\n      className={classnames(\n        'MapExplorer',\n        {stickied},\n        {\n          hidden:\n            anchor && anchor !== 'mapexplorer' && (!expandTable || width < 769),\n        }\n      )}\n    >\n      <div\n        className={classnames('anchor', 'fadeInUp', {\n          stickied,\n        })}\n        style={{\n          display: width < 769 || (width >= 769 && expandTable) ? 'none' : '',\n        }}\n        onClick={\n          setAnchor &&\n          setAnchor.bind(this, anchor === 'mapexplorer' ? null : 'mapexplorer')\n        }\n      >\n        <PinIcon />\n      </div>\n      <div className=\"panel\" ref={panelRef}>\n        <div className=\"panel-left fadeInUp\" style={trail[0]}>\n          <h2\n            className={classnames(mapStatistic)}\n            style={{color: zoneColor || statisticConfig?.color}}\n          >\n            {t(hoveredRegion.name)}\n            {hoveredRegion.name === UNKNOWN_DISTRICT_KEY &&\n              ` [${t(STATE_NAMES[regionHighlighted.stateCode])}]`}\n          </h2>\n\n          {regionHighlighted.stateCode && (\n            <h1\n              className={classnames('district', mapStatistic)}\n              style={{color: zoneColor || statisticConfig?.color}}\n            >\n              <animated.div>\n                {spring.total.to((total) =>\n                  !noRegionHighlightedDistrictData ||\n                  !statisticConfig?.hasPrimary\n                    ? formatNumber(total, statisticConfig.format, mapStatistic)\n                    : '-'\n                )}\n              </animated.div>\n              <StatisticDropdown\n                currentStatistic={mapStatistic}\n                statistics={mapStatistics}\n                mapType={mapMeta.mapType}\n                {...{\n                  isPerLakh,\n                  delta7Mode,\n                  mapStatistic,\n                  setMapStatistic,\n                  hideDistrictTestData,\n                  hideVaccinated,\n                  zoneColor,\n                }}\n              />\n            </h1>\n          )}\n        </div>\n\n        <div className={classnames('panel-right', `is-${mapStatistic}`)}>\n          <div className=\"switch-type\">\n            <Tooltip message={'Last 7 day values'} hold>\n              <div\n                className={classnames('toggle', 'fadeInUp', {\n                  'is-highlighted':\n                    (delta7Mode && statisticConfig?.showDelta) ||\n                    statisticConfig?.onlyDelta7,\n                  disabled: !statisticConfig?.showDelta,\n                })}\n                onClick={handleDeltaClick}\n                style={trail[1]}\n              >\n                <Delta7Icon />\n              </div>\n            </Tooltip>\n\n            <Tooltip message={'Per lakh people'} hold>\n              <div\n                className={classnames('toggle', 'fadeInUp', {\n                  'is-highlighted':\n                    !statisticConfig?.nonLinear &&\n                    mapViz === MAP_VIZS.CHOROPLETH,\n                  disabled:\n                    statisticConfig?.nonLinear || mapStatistic === 'population',\n                })}\n                onClick={handlePerLakhClick}\n                style={trail[2]}\n              >\n                <PerLakhIcon />\n              </div>\n            </Tooltip>\n\n            {mapMeta.mapType === MAP_TYPES.COUNTRY && (\n              <Tooltip message={'Toggle between states/districts'} hold>\n                <div\n                  className={classnames('toggle', 'boundary fadeInUp', {\n                    'is-highlighted': isDistrictView,\n                    disabled:\n                      hideDistrictData ||\n                      (statisticConfig?.category === 'tested' &&\n                        hideDistrictTestData),\n                  })}\n                  onClick={handleDistrictClick}\n                  style={trail[3]}\n                >\n                  <OrganizationIcon />\n                </div>\n              </Tooltip>\n            )}\n\n            {mapMeta.mapType === MAP_TYPES.STATE && (\n              <>\n                <div className=\"divider\" />\n                <div\n                  className=\"toggle back fadeInUp\"\n                  onClick={() => {\n                    history.push('/#MapExplorer');\n                  }}\n                  style={trail[4]}\n                >\n                  <ArrowLeftIcon />\n                </div>\n              </>\n            )}\n          </div>\n\n          <div className=\"switch-statistic fadeInUp\" style={trail[5]}>\n            {mapStatistics.map((statistic) => (\n              <div\n                key={statistic}\n                className={classnames(\n                  'toggle',\n                  'statistic-option',\n                  `is-${statistic}`,\n                  {\n                    'is-highlighted': mapStatistic === statistic,\n                  }\n                )}\n                onClick={setMapStatistic.bind(this, statistic)}\n              >\n                <DotFillIcon />\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      <div\n        ref={mapExplorerRef}\n        className=\"fadeInUp\"\n        style={trail[3]}\n        {...swipeHandlers}\n      >\n        {mapStatistic && (\n          <Suspense\n            fallback={\n              <MapVisualizerLoader\n                className=\"map-loader\"\n                {...{\n                  width: mapExplorerRef.current?.clientWidth,\n                  statistic: mapStatistic,\n                }}\n              />\n            }\n          >\n            <MapVisualizer\n              data={mapData}\n              statistic={mapStatistic}\n              {...{\n                mapCode,\n                isDistrictView,\n                mapViz,\n                regionHighlighted,\n                setRegionHighlighted,\n                getMapStatistic,\n                transformStatistic,\n                noDistrictData,\n              }}\n            ></MapVisualizer>\n          </Suspense>\n        )}\n      </div>\n    </div>\n  );\n}\n\nconst isEqual = (prevProps, currProps) => {\n  if (!equal(prevProps.stateCode, currProps.stateCode)) {\n    return false;\n  } else if (!equal(prevProps.regionHighlighted, currProps.regionHighlighted)) {\n    return false;\n  } else if (!equal(prevProps.mapView, currProps.mapView)) {\n    return false;\n  } else if (!equal(prevProps.mapStatistic, currProps.mapStatistic)) {\n    return false;\n  } else if (!equal(prevProps.anchor, currProps.anchor)) {\n    return false;\n  } else if (!equal(prevProps.expandTable, currProps.expandTable)) {\n    return false;\n  } else if (!equal(prevProps.hideDistrictData, currProps.hideDistrictData)) {\n    return false;\n  } else if (\n    !equal(prevProps.hideDistrictTestData, currProps.hideDistrictTestData)\n  ) {\n    return false;\n  } else if (!equal(prevProps.hideVaccinated, currProps.hideVaccinated)) {\n    return false;\n  } else if (!equal(prevProps.lastDataDate, currProps.lastDataDate)) {\n    return false;\n  } else if (\n    !equal(\n      prevProps.data?.TT?.meta?.['last_updated'],\n      currProps.data?.TT?.meta?.['last_updated']\n    )\n  ) {\n    return false;\n  } else if (!equal(prevProps.data?.TT?.total, currProps.data?.TT?.total)) {\n    return false;\n  } else if (\n    !equal(\n      prevProps.noRegionHighlightedDistrictData,\n      currProps.noRegionHighlightedDistrictData\n    )\n  ) {\n    return false;\n  } else if (!equal(prevProps.noDistrictData, currProps.noDistrictData)) {\n    return false;\n  }\n  return true;\n};\n\nexport default memo(MapExplorer, isEqual);\n"]},"metadata":{},"sourceType":"module"}