{"ast":null,"code":"import _slicedToArray from\"/Users/nawaf/code/Create-a-D3-Dashboard-With-React-/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{API_REFRESH_INTERVAL,DATA_API_ROOT,DISTRICT_START_DATE,DISTRICT_TEST_END_DATE,MAP_VIEWS,TESTED_EXPIRING_DAYS,PRIMARY_STATISTICS,UNKNOWN_DISTRICT_KEY}from'../constants';import useIsVisible from'../hooks/useIsVisible';import useStickySWR from'../hooks/useStickySWR';import{getStatistic,fetcher,retry,parseSaudiaDate,formatDateObjSaudia}from'../utils/commonFunctions';import classnames from'classnames';import{addDays,formatISO,max}from'date-fns';import{useMemo,useRef,useState,lazy,Suspense}from'react';import{Helmet}from'react-helmet';import{useLocation}from'react-router-dom';import{useLocalStorage,useSessionStorage,useWindowSize}from'react-use';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Actions=/*#__PURE__*/lazy(function(){return retry(function(){return import('./Actions');});});var MapSwitcher=/*#__PURE__*/lazy(function(){return retry(function(){return import('./MapSwitcher');});});var Level=/*#__PURE__*/lazy(function(){return retry(function(){return import('./Level');});});var Minigraphs=/*#__PURE__*/lazy(function(){return retry(function(){return import('./Minigraphs');});});var StateHeader=/*#__PURE__*/lazy(function(){return retry(function(){return import('./StateHeader');});});var MapExplorer=/*#__PURE__*/lazy(function(){return retry(function(){return import('./MapExplorer');});});function Home(){var _timeseries$TT,_timeseries$TT2;var _useState=useState({stateCode:'TT',districtName:null}),_useState2=_slicedToArray(_useState,2),regionHighlighted=_useState2[0],setRegionHighlighted=_useState2[1];var _useLocalStorage=useLocalStorage('anchor',null),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),anchor=_useLocalStorage2[0],setAnchor=_useLocalStorage2[1];var _useLocalStorage3=useLocalStorage('expandTable',false),_useLocalStorage4=_slicedToArray(_useLocalStorage3,1),expandTable=_useLocalStorage4[0];var _useSessionStorage=useSessionStorage('mapStatistic','active'),_useSessionStorage2=_slicedToArray(_useSessionStorage,2),mapStatistic=_useSessionStorage2[0],setMapStatistic=_useSessionStorage2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),date=_useState4[0],setDate=_useState4[1];var location=useLocation();var _useLocalStorage5=useLocalStorage('mapView',MAP_VIEWS.DISTRICTS),_useLocalStorage6=_slicedToArray(_useLocalStorage5,2),mapView=_useLocalStorage6[0],setMapView=_useLocalStorage6[1];var hideDistrictData=date!==''&&date<DISTRICT_START_DATE;var hideDistrictTestData=date===''||date>formatISO(addDays(parseSaudiaDate(DISTRICT_TEST_END_DATE),TESTED_EXPIRING_DAYS),{representation:'date'});var _useStickySWR=useStickySWR(\"\".concat(DATA_API_ROOT,\"/timeseries.min.json\"),fetcher,{revalidateOnMount:true,refreshInterval:API_REFRESH_INTERVAL}),timeseries=_useStickySWR.data;var _useStickySWR2=useStickySWR(\"\".concat(DATA_API_ROOT,\"/data\").concat(date?\"-\".concat(date):'',\".min.json\"),fetcher,{revalidateOnMount:true,refreshInterval:API_REFRESH_INTERVAL}),data=_useStickySWR2.data;var homeRightElement=useRef();var isVisible=useIsVisible(homeRightElement);var _useWindowSize=useWindowSize(),width=_useWindowSize.width;var hideVaccinated=getStatistic(data===null||data===void 0?void 0:data['TT'],'total','vaccinated')===0;var lastDataDate=useMemo(function(){var _data$TT,_data$TT$meta,_data$TT2,_data$TT2$meta,_data$TT2$meta$tested,_data$TT3,_data$TT3$meta,_data$TT3$meta$vaccin;var updatedDates=[data===null||data===void 0?void 0:(_data$TT=data['TT'])===null||_data$TT===void 0?void 0:(_data$TT$meta=_data$TT.meta)===null||_data$TT$meta===void 0?void 0:_data$TT$meta.date,data===null||data===void 0?void 0:(_data$TT2=data['TT'])===null||_data$TT2===void 0?void 0:(_data$TT2$meta=_data$TT2.meta)===null||_data$TT2$meta===void 0?void 0:(_data$TT2$meta$tested=_data$TT2$meta.tested)===null||_data$TT2$meta$tested===void 0?void 0:_data$TT2$meta$tested.date,data===null||data===void 0?void 0:(_data$TT3=data['TT'])===null||_data$TT3===void 0?void 0:(_data$TT3$meta=_data$TT3.meta)===null||_data$TT3$meta===void 0?void 0:(_data$TT3$meta$vaccin=_data$TT3$meta.vaccinated)===null||_data$TT3$meta$vaccin===void 0?void 0:_data$TT3$meta$vaccin.date].filter(function(date){return date;});return updatedDates.length>0?formatISO(max(updatedDates.map(function(date){return parseSaudiaDate(date);})),{representation:'date'}):null;},[data]);var lastUpdatedDate=useMemo(function(){var updatedDates=Object.keys(data||{}).map(function(stateCode){var _data$stateCode,_data$stateCode$meta;return data===null||data===void 0?void 0:(_data$stateCode=data[stateCode])===null||_data$stateCode===void 0?void 0:(_data$stateCode$meta=_data$stateCode.meta)===null||_data$stateCode$meta===void 0?void 0:_data$stateCode$meta['last_updated'];}).filter(function(datetime){return datetime;});return updatedDates.length>0?formatDateObjSaudia(max(updatedDates.map(function(datetime){return parseSaudiaDate(datetime);}))):null;},[data]);var noDistrictDataStates=useMemo(function(){return(// Heuristic: All cases are in Unknown\nObject.entries(data||{}).reduce(function(res,_ref){var _stateData$districts;var _ref2=_slicedToArray(_ref,2),stateCode=_ref2[0],stateData=_ref2[1];res[stateCode]=!!((stateData===null||stateData===void 0?void 0:stateData.districts)&&((_stateData$districts=stateData.districts)===null||_stateData$districts===void 0?void 0:_stateData$districts[UNKNOWN_DISTRICT_KEY])&&PRIMARY_STATISTICS.every(function(statistic){return getStatistic(stateData,'total',statistic)===getStatistic(stateData.districts[UNKNOWN_DISTRICT_KEY],'total',statistic);}));return res;},{}));},[data]);var noRegionHighlightedDistrictData=(regionHighlighted===null||regionHighlighted===void 0?void 0:regionHighlighted.stateCode)&&(regionHighlighted===null||regionHighlighted===void 0?void 0:regionHighlighted.districtName)&&regionHighlighted.districtName!==UNKNOWN_DISTRICT_KEY&&noDistrictDataStates[regionHighlighted.stateCode];return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Helmet,{children:[/*#__PURE__*/_jsx(\"title\",{children:\"Coronavirus Outbreak in Saudia - Saudi.org\"}),/*#__PURE__*/_jsx(\"meta\",{name:\"title\",content:\"Coronavirus Outbreak in Saudia: Latest Map and Case Count\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"Home\",children:[/*#__PURE__*/_jsxs(\"div\",{className:classnames('home-left',{expanded:expandTable}),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{})}),!data&&!timeseries&&/*#__PURE__*/_jsx(\"div\",{style:{height:'60rem'}}),/*#__PURE__*/_jsxs(_Fragment,{children:[!timeseries&&/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'61px'}}),timeseries&&/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'61px'}}),children:/*#__PURE__*/_jsx(Actions,{date:date,setDate:setDate,dates:Object.keys((_timeseries$TT=timeseries['TT'])===null||_timeseries$TT===void 0?void 0:_timeseries$TT.dates),lastUpdatedDate:lastUpdatedDate})})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',marginTop:'1rem'},children:[data&&/*#__PURE__*/_jsxs(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{style:{height:'50rem'}}),children:[width>=769&&!expandTable&&/*#__PURE__*/_jsx(MapSwitcher,{mapStatistic:mapStatistic,setMapStatistic:setMapStatistic}),/*#__PURE__*/_jsx(Level,{data:data['TT']})]}),/*#__PURE__*/_jsxs(_Fragment,{children:[!timeseries&&/*#__PURE__*/_jsx(\"div\",{style:{height:'123px'}}),timeseries&&/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{style:{height:'123px'}}),children:/*#__PURE__*/_jsx(Minigraphs,{timeseries:(_timeseries$TT2=timeseries['TT'])===null||_timeseries$TT2===void 0?void 0:_timeseries$TT2.dates,date:date})})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:classnames('home-right',{expanded:expandTable}),ref:homeRightElement,style:{minHeight:'4rem'},children:(isVisible||location.hash)&&/*#__PURE__*/_jsxs(_Fragment,{children:[data&&/*#__PURE__*/_jsx(\"div\",{className:classnames('map-container',{expanded:expandTable,stickied:anchor==='mapexplorer'||expandTable&&width>=769}),children:/*#__PURE__*/_jsxs(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{style:{height:'50rem'}}),children:[/*#__PURE__*/_jsx(StateHeader,{data:data['TT'],stateCode:'TT'}),/*#__PURE__*/_jsx(MapExplorer,{stateCode:'TT',data:data,mapStatistic:mapStatistic,setMapStatistic:setMapStatistic,mapView:mapView,setMapView:setMapView,regionHighlighted:regionHighlighted,setRegionHighlighted:setRegionHighlighted,anchor:anchor,setAnchor:setAnchor,expandTable:expandTable,lastDataDate:lastDataDate,hideDistrictData:hideDistrictData,hideDistrictTestData:hideDistrictTestData,hideVaccinated:hideVaccinated,noRegionHighlightedDistrictData:noRegionHighlightedDistrictData})]})}),timeseries&&/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{style:{height:'50rem'}})})]})})]}),isVisible&&/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{})})]});}export default Home;","map":{"version":3,"sources":["/Users/nawaf/code/Create-a-D3-Dashboard-With-React-/src/components/Home.js"],"names":["API_REFRESH_INTERVAL","DATA_API_ROOT","DISTRICT_START_DATE","DISTRICT_TEST_END_DATE","MAP_VIEWS","TESTED_EXPIRING_DAYS","PRIMARY_STATISTICS","UNKNOWN_DISTRICT_KEY","useIsVisible","useStickySWR","getStatistic","fetcher","retry","parseSaudiaDate","formatDateObjSaudia","classnames","addDays","formatISO","max","useMemo","useRef","useState","lazy","Suspense","Helmet","useLocation","useLocalStorage","useSessionStorage","useWindowSize","Actions","MapSwitcher","Level","Minigraphs","StateHeader","MapExplorer","Home","stateCode","districtName","regionHighlighted","setRegionHighlighted","anchor","setAnchor","expandTable","mapStatistic","setMapStatistic","date","setDate","location","DISTRICTS","mapView","setMapView","hideDistrictData","hideDistrictTestData","representation","revalidateOnMount","refreshInterval","timeseries","data","homeRightElement","isVisible","width","hideVaccinated","lastDataDate","updatedDates","meta","tested","vaccinated","filter","length","map","lastUpdatedDate","Object","keys","datetime","noDistrictDataStates","entries","reduce","res","stateData","districts","every","statistic","noRegionHighlightedDistrictData","expanded","height","minHeight","dates","position","marginTop","hash","stickied"],"mappings":"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","sourcesContent":["import {\n  API_REFRESH_INTERVAL,\n  DATA_API_ROOT,\n  DISTRICT_START_DATE,\n  DISTRICT_TEST_END_DATE,\n  MAP_VIEWS,\n  TESTED_EXPIRING_DAYS,\n  PRIMARY_STATISTICS,\n  UNKNOWN_DISTRICT_KEY,\n} from '../constants';\nimport useIsVisible from '../hooks/useIsVisible';\nimport useStickySWR from '../hooks/useStickySWR';\nimport {\n  getStatistic,\n  fetcher,\n  retry,\n  parseSaudiaDate,\n  formatDateObjSaudia,\n} from '../utils/commonFunctions';\n\nimport classnames from 'classnames';\nimport {addDays, formatISO, max} from 'date-fns';\nimport {useMemo, useRef, useState, lazy, Suspense} from 'react';\nimport {Helmet} from 'react-helmet';\nimport {useLocation} from 'react-router-dom';\nimport {useLocalStorage, useSessionStorage, useWindowSize} from 'react-use';\n\nconst Actions = lazy(() => retry(() => import('./Actions')));\nconst MapSwitcher = lazy(() => retry(() => import('./MapSwitcher')));\nconst Level = lazy(() => retry(() => import('./Level')));\nconst Minigraphs = lazy(() => retry(() => import('./Minigraphs')));\nconst StateHeader = lazy(() => retry(() => import('./StateHeader')));\nconst MapExplorer = lazy(() => retry(() => import('./MapExplorer')));\n\nfunction Home() {\n  const [regionHighlighted, setRegionHighlighted] = useState({\n    stateCode: 'TT',\n    districtName: null,\n  });\n  const [anchor, setAnchor] = useLocalStorage('anchor', null);\n  const [expandTable] = useLocalStorage('expandTable', false);\n\n  const [mapStatistic, setMapStatistic] = useSessionStorage(\n    'mapStatistic',\n    'active'\n  );\n\n  const [date, setDate] = useState('');\n  const location = useLocation();\n\n  const [mapView, setMapView] = useLocalStorage('mapView', MAP_VIEWS.DISTRICTS);\n\n  const hideDistrictData = date !== '' && date < DISTRICT_START_DATE;\n  const hideDistrictTestData =\n    date === '' ||\n    date >\n      formatISO(\n        addDays(parseSaudiaDate(DISTRICT_TEST_END_DATE), TESTED_EXPIRING_DAYS),\n        {representation: 'date'}\n      );\n\n  const {data: timeseries} = useStickySWR(\n    `${DATA_API_ROOT}/timeseries.min.json`,\n    fetcher,\n    {\n      revalidateOnMount: true,\n      refreshInterval: API_REFRESH_INTERVAL,\n    }\n  );\n\n  const {data} = useStickySWR(\n    `${DATA_API_ROOT}/data${date ? `-${date}` : ''}.min.json`,\n    fetcher,\n    {\n      revalidateOnMount: true,\n      refreshInterval: API_REFRESH_INTERVAL,\n    }\n  );\n\n  const homeRightElement = useRef();\n  const isVisible = useIsVisible(homeRightElement);\n  const {width} = useWindowSize();\n\n  const hideVaccinated =\n    getStatistic(data?.['TT'], 'total', 'vaccinated') === 0;\n\n  const lastDataDate = useMemo(() => {\n    const updatedDates = [\n      data?.['TT']?.meta?.date,\n      data?.['TT']?.meta?.tested?.date,\n      data?.['TT']?.meta?.vaccinated?.date,\n    ].filter((date) => date);\n    return updatedDates.length > 0\n      ? formatISO(max(updatedDates.map((date) => parseSaudiaDate(date))), {\n          representation: 'date',\n        })\n      : null;\n  }, [data]);\n\n  const lastUpdatedDate = useMemo(() => {\n    const updatedDates = Object.keys(data || {})\n      .map((stateCode) => data?.[stateCode]?.meta?.['last_updated'])\n      .filter((datetime) => datetime);\n    return updatedDates.length > 0\n      ? formatDateObjSaudia(\n          max(updatedDates.map((datetime) => parseSaudiaDate(datetime)))\n        )\n      : null;\n  }, [data]);\n\n  const noDistrictDataStates = useMemo(\n    () =>\n      // Heuristic: All cases are in Unknown\n      Object.entries(data || {}).reduce((res, [stateCode, stateData]) => {\n        res[stateCode] = !!(\n          stateData?.districts &&\n          stateData.districts?.[UNKNOWN_DISTRICT_KEY] &&\n          PRIMARY_STATISTICS.every(\n            (statistic) =>\n              getStatistic(stateData, 'total', statistic) ===\n              getStatistic(\n                stateData.districts[UNKNOWN_DISTRICT_KEY],\n                'total',\n                statistic\n              )\n          )\n        );\n        return res;\n      }, {}),\n    [data]\n  );\n\n  const noRegionHighlightedDistrictData =\n    regionHighlighted?.stateCode &&\n    regionHighlighted?.districtName &&\n    regionHighlighted.districtName !== UNKNOWN_DISTRICT_KEY &&\n    noDistrictDataStates[regionHighlighted.stateCode];\n\n  return (\n    <>\n      <Helmet>\n        <title>Coronavirus Outbreak in Saudia - Saudi.org</title>\n        <meta\n          name=\"title\"\n          content=\"Coronavirus Outbreak in Saudia: Latest Map and Case Count\"\n        />\n      </Helmet>\n\n      <div className=\"Home\">\n        <div className={classnames('home-left', {expanded: expandTable})}>\n          <div className=\"header\">\n            <Suspense fallback={<div />}></Suspense>\n\n            {!data && !timeseries && <div style={{height: '60rem'}} />}\n\n            <>\n              {!timeseries && <div style={{minHeight: '61px'}} />}\n              {timeseries && (\n                <Suspense fallback={<div style={{minHeight: '61px'}} />}>\n                  <Actions\n                    {...{\n                      date,\n                      setDate,\n                      dates: Object.keys(timeseries['TT']?.dates),\n                      lastUpdatedDate,\n                    }}\n                  />\n                </Suspense>\n              )}\n            </>\n          </div>\n\n          <div style={{position: 'relative', marginTop: '1rem'}}>\n            {data && (\n              <Suspense fallback={<div style={{height: '50rem'}} />}>\n                {width >= 769 && !expandTable && (\n                  <MapSwitcher {...{mapStatistic, setMapStatistic}} />\n                )}\n                <Level data={data['TT']} />\n              </Suspense>\n            )}\n\n            <>\n              {!timeseries && <div style={{height: '123px'}} />}\n              {timeseries && (\n                <Suspense fallback={<div style={{height: '123px'}} />}>\n                  <Minigraphs\n                    timeseries={timeseries['TT']?.dates}\n                    {...{date}}\n                  />\n                </Suspense>\n              )}\n            </>\n          </div>\n        </div>\n\n        <div\n          className={classnames('home-right', {expanded: expandTable})}\n          ref={homeRightElement}\n          style={{minHeight: '4rem'}}\n        >\n          {(isVisible || location.hash) && (\n            <>\n              {data && (\n                <div\n                  className={classnames('map-container', {\n                    expanded: expandTable,\n                    stickied:\n                      anchor === 'mapexplorer' || (expandTable && width >= 769),\n                  })}\n                >\n                  <Suspense fallback={<div style={{height: '50rem'}} />}>\n                    <StateHeader data={data['TT']} stateCode={'TT'} />\n                    <MapExplorer\n                      {...{\n                        stateCode: 'TT',\n                        data,\n                        mapStatistic,\n                        setMapStatistic,\n                        mapView,\n                        setMapView,\n                        regionHighlighted,\n                        setRegionHighlighted,\n                        anchor,\n                        setAnchor,\n                        expandTable,\n                        lastDataDate,\n                        hideDistrictData,\n                        hideDistrictTestData,\n                        hideVaccinated,\n                        noRegionHighlightedDistrictData,\n                      }}\n                    />\n                  </Suspense>\n                </div>\n              )}\n\n              {timeseries && (\n                <Suspense\n                  fallback={<div style={{height: '50rem'}} />}\n                ></Suspense>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n\n      {isVisible && <Suspense fallback={<div />}></Suspense>}\n    </>\n  );\n}\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}